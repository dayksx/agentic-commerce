{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 172, "column": 0}, "map": {"version":3,"sources":["file:///home/dayan/Workspace/ethglobal-server-agent/ui/scripts/query-x402-payments.ts"],"sourcesContent":["import { createPublicClient, http, formatUnits, parseAbiItem } from 'viem';\nimport { baseSepolia } from 'viem/chains';\nimport { CdpClient } from '@coinbase/cdp-sdk';\n\n// USDC token address on Base Sepolia\nconst USDC_ADDRESS = '0x036CbD53842c5426634e7929541eC2318f3dCF7e';\nconst DEFAULT_PAYMENT_ADDRESS = '0x42849E96716efDBCCb6416e7E099830C0b1Eb34f';\n\nasync function getPaymentAddress(): Promise<`0x${string}`> {\n  try {\n    const accountName = process.env.CDP_PAYMENT_ACCOUNT_NAME;\n    const accountAddress = process.env.CDP_PAYMENT_ACCOUNT_ADDRESS;\n\n    const cdp = new CdpClient();\n\n    if (accountName) {\n      const account = await cdp.evm.getOrCreateAccount({ name: accountName });\n      return account.address;\n    }\n    if (accountAddress) {\n      const account = await cdp.evm.getAccount({ address: accountAddress as `0x${string}` });\n      return account.address;\n    }\n    const account = await cdp.evm.getOrCreateAccount({ name: \"mcp-payment-receiver\" });\n    return account.address;\n\n  } catch {\n    return (process.env.MCP_PAYMENT_ADDRESS || DEFAULT_PAYMENT_ADDRESS) as `0x${string}`;\n  }\n}\n\n// Public client\nconst publicClient = createPublicClient({\n  chain: baseSepolia,\n  transport: http(),\n});\n\nexport interface PaymentInfo {\n  transactionHash: string;\n  blockNumber: bigint;\n  timestamp: Date;\n  from: string;\n  amount: string;\n  amountUSD: string;\n}\n\nexport async function queryPayments(limit: number = 100): Promise<PaymentInfo[]> {\n  const PAYMENT_ADDRESS = await getPaymentAddress();\n  const currentBlock = await publicClient.getBlockNumber();\n\n  const transferEvent = parseAbiItem(\n    'event Transfer(address indexed from, address indexed to, uint256 value)'\n  );\n\n  const transferEvents = await publicClient.getLogs({\n    address: USDC_ADDRESS,\n    event: transferEvent,\n    args: { to: PAYMENT_ADDRESS },\n    fromBlock: currentBlock - 10000n,\n    toBlock: 'latest',\n  });\n\n  const payments: PaymentInfo[] = [];\n\n  for (const event of transferEvents.slice(0, limit)) {\n    const block = await publicClient.getBlock({ blockNumber: event.blockNumber });\n    const amount = formatUnits(event.args.value || 0n, 6);\n    \n    payments.push({\n      transactionHash: event.transactionHash,\n      blockNumber: event.blockNumber,\n      timestamp: new Date(Number(block.timestamp) * 1000),\n      from: event.args.from || 'unknown',\n      amount,\n      amountUSD: `$${Number(amount).toFixed(2)}`\n    });\n  }\n\n  return payments.sort((a, b) => Number(b.blockNumber) - Number(a.blockNumber));\n}\n\n// RUN ONLY IF CLI\nif (process.argv[1]?.includes('query-x402-payments')) {\n  queryPayments(50).then(console.log);\n}"],"names":[],"mappings":";;;;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;;;AAEA,qCAAqC;AACrC,MAAM,eAAe;AACrB,MAAM,0BAA0B;AAEhC,eAAe;IACb,IAAI;QACF,MAAM,cAAc,QAAQ,GAAG,CAAC,wBAAwB;QACxD,MAAM,iBAAiB,QAAQ,GAAG,CAAC,2BAA2B;QAE9D,MAAM,MAAM,IAAI,8WAAS;QAEzB,IAAI,aAAa;YACf,MAAM,UAAU,MAAM,IAAI,GAAG,CAAC,kBAAkB,CAAC;gBAAE,MAAM;YAAY;YACrE,OAAO,QAAQ,OAAO;QACxB;QACA,IAAI,gBAAgB;YAClB,MAAM,UAAU,MAAM,IAAI,GAAG,CAAC,UAAU,CAAC;gBAAE,SAAS;YAAgC;YACpF,OAAO,QAAQ,OAAO;QACxB;QACA,MAAM,UAAU,MAAM,IAAI,GAAG,CAAC,kBAAkB,CAAC;YAAE,MAAM;QAAuB;QAChF,OAAO,QAAQ,OAAO;IAExB,EAAE,OAAM;QACN,OAAQ,QAAQ,GAAG,CAAC,mBAAmB,IAAI;IAC7C;AACF;AAEA,gBAAgB;AAChB,MAAM,eAAe,IAAA,2VAAkB,EAAC;IACtC,OAAO,2VAAW;IAClB,WAAW,IAAA,6UAAI;AACjB;AAWO,eAAe,cAAc,QAAgB,GAAG;IACrD,MAAM,kBAAkB,MAAM;IAC9B,MAAM,eAAe,MAAM,aAAa,cAAc;IAEtD,MAAM,gBAAgB,IAAA,sSAAY,EAChC;IAGF,MAAM,iBAAiB,MAAM,aAAa,OAAO,CAAC;QAChD,SAAS;QACT,OAAO;QACP,MAAM;YAAE,IAAI;QAAgB;QAC5B,WAAW,eAAe,MAAM;QAChC,SAAS;IACX;IAEA,MAAM,WAA0B,EAAE;IAElC,KAAK,MAAM,SAAS,eAAe,KAAK,CAAC,GAAG,OAAQ;QAClD,MAAM,QAAQ,MAAM,aAAa,QAAQ,CAAC;YAAE,aAAa,MAAM,WAAW;QAAC;QAC3E,MAAM,SAAS,IAAA,mVAAW,EAAC,MAAM,IAAI,CAAC,KAAK,IAAI,EAAE,EAAE;QAEnD,SAAS,IAAI,CAAC;YACZ,iBAAiB,MAAM,eAAe;YACtC,aAAa,MAAM,WAAW;YAC9B,WAAW,IAAI,KAAK,OAAO,MAAM,SAAS,IAAI;YAC9C,MAAM,MAAM,IAAI,CAAC,IAAI,IAAI;YACzB;YACA,WAAW,CAAC,CAAC,EAAE,OAAO,QAAQ,OAAO,CAAC,IAAI;QAC5C;IACF;IAEA,OAAO,SAAS,IAAI,CAAC,CAAC,GAAG,IAAM,OAAO,EAAE,WAAW,IAAI,OAAO,EAAE,WAAW;AAC7E;AAEA,kBAAkB;AAClB,IAAI,QAAQ,IAAI,CAAC,EAAE,EAAE,SAAS,wBAAwB;IACpD,cAAc,IAAI,IAAI,CAAC,QAAQ,GAAG;AACpC"}},
    {"offset": {"line": 256, "column": 0}, "map": {"version":3,"sources":["file:///home/dayan/Workspace/ethglobal-server-agent/ui/app/api/payments/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { queryPayments } from '@/scripts/query-x402-payments';\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const limit = Number(searchParams.get(\"limit\") ?? 50);\n\n    const payments = await queryPayments(limit);\n\n    // Serialize bigint and Date for JSON response\n    const serializedPayments = payments.map(payment => ({\n      ...payment,\n      blockNumber: typeof payment.blockNumber === 'bigint' \n        ? payment.blockNumber.toString() \n        : payment.blockNumber,\n      timestamp: payment.timestamp instanceof Date \n        ? payment.timestamp.toISOString() \n        : payment.timestamp,\n    }));\n\n    return NextResponse.json(serializedPayments);\n  } catch (error) {\n    console.error('Error fetching payments:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch payments', details: error instanceof Error ? error.message : 'Unknown error' },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,QAAQ,OAAO,aAAa,GAAG,CAAC,YAAY;QAElD,MAAM,WAAW,MAAM,IAAA,6JAAa,EAAC;QAErC,8CAA8C;QAC9C,MAAM,qBAAqB,SAAS,GAAG,CAAC,CAAA,UAAW,CAAC;gBAClD,GAAG,OAAO;gBACV,aAAa,OAAO,QAAQ,WAAW,KAAK,WACxC,QAAQ,WAAW,CAAC,QAAQ,KAC5B,QAAQ,WAAW;gBACvB,WAAW,QAAQ,SAAS,YAAY,OACpC,QAAQ,SAAS,CAAC,WAAW,KAC7B,QAAQ,SAAS;YACvB,CAAC;QAED,OAAO,qRAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,qRAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAA4B,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAAgB,GACvG;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}